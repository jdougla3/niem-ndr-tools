#!/usr/bin/env bash

. "$(dirname "$0")"/../lib/common.bash
. "$NDR_TOOLS_ROOT_DIR"/lib/fn_test.bash
. "$NDR_TOOLS_ROOT_DIR"/lib/fn_fail.bash
. "$NDR_TOOLS_ROOT_DIR"/lib/temp.bash

cd "$(dirname "$0")"

vecho_location

EXIT_STATUS=0

temp_make_file TESTS

while read -r -d $'\n'
do rule_dir=rules/$REPLY
    if [[ -d $rule_dir ]]
    then find "$rule_dir" -type f -name 'run-test*' ! -name '*~' -perm -500 > "$TESTS"
        if [[ ! -s $TESTS ]]
        then test_fail "File: No tests for rule \"$REPLY\""
        fi
    else test_fail "Fail: No rule dir for rule \"$REPLY\""
    fi
done < <("$NDR_TOOLS_ROOT_DIR"/bin/xalan -- -IN "$NDR_TOOLS_ROOT_DIR"/lib/ndr-id-map.xml -XSL "$NDR_TOOLS_ROOT_DIR"/lib/get-descriptive-ids.xsl)

test_exit
